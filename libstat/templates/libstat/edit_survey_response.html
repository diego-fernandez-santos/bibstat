{% extends "libstat/base.html" %}
{% load i18n %}

{% block content %}
  <div class="container">

    <div class="row">
      <div class="col-md-8">
        <div class="page-header">
          <h1>{% trans "Statistikenkät" %} {{form.instance.sample_year|add:"1"}}</h1>
        </div>
    
        <form action="" method="POST" role="form" class="form edit-survey-response-form">
          {% csrf_token %}
          
          <div class="panel panel-default inverse">
            <div class="panel-heading">
              <h3 class="panel-title">Respondentdata</h3>
            </div>
            <div class="panel-body">
            
              <div class="form-group">
                <div class="row">
                  <div class="col-md-3">
                    <label for="id_sample_year">{% trans "Mätår" %}:</label>
                  </div>
                  <div class="col-md-9">
                    <span>{{form.instance.sample_year}}</span>
                    {{form.sample_year}}
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-3">
                    <label for="id_target_group">{% trans "Målgrupp" %}:</label>
                  </div>
                  <div class="col-md-9">             
                    <span>{{form.instance.target_group__desc}}</span>
                    {{form.target_group}}
                   </div>
                </div>
                <div class="row">
                  <div class="col-md-3">
                    <label for="date_modified">{% trans "Senast ändrad" %}:</label>
                  </div>
                  <div class="col-md-9">
                    <span id="date_modified">{{form.instance.date_modified|date:"Y-m-d H:i"}}</span> <!--TODO:  <span>av Cecilia Ranemo</span> -->
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-3">
                    <label for="published_at">{% trans "Publicerad" %}:</label>
                  </div>
                  <div class="col-md-9">
                    <span id="published_at">
                      {% if form.instance.latest_version_published  %}
                        <span class="published_at">{{form.instance.published_at|date:"Y-m-d H:i"}}</span> 
                        <!--TODO: <span>av Cecilia Ranemo.</span> -->
                      {% elif form.instance.latest_version_modified %}
                        <span class="published_at">{{form.instance.published_at|date:"Y-m-d H:i"}}</span> 
                        <!--TODO: <span>av Cecilia Ranemo</span> --> 
                        <span class="text-warning form-validation after">{% trans "Enkätsvaret har ändrats efter senaste publicering " %}</span>
                      {% elif form.instance.not_published %}
                        <span class="published_at">{% trans "Ej publicerad" %}</span>
                      {% endif %}
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-12">
                  <label>{% trans "Svarande bibliotek" %}</label>
                </div>
              </div>
              <!-- Nested panel, it seems to work... -->
              <div class="panel panel-default responding-library">
                <div class="panel-body">
                  <div class="row form-group">
                    <div class="col-md-3">
                      <label for="id_library_name">{% trans "Namn" %}:</label>
                    </div>
                    <div class="col-md-9">
                      {{form.library_name}}
                    </div>
                  </div>
                  <div class="row form-group">
                    <div class="col-md-3">
                      <label for="id_municipality_name">{% trans "Kommun/län" %}:</label>
                    </div>
                    <div class="col-md-9">
                      {{form.municipality_name}}
                    </div>
                  </div>
                  <div class="row form-group">
                    <div class="col-md-3">
                      <label for="id_municipality_code">{% trans "Kommun/länskod" %}:</label>
                    </div>
                    <div class="col-md-9">
                      {{form.municipality_code}}
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-12">
                  <label>{% trans "Svarande person" %}</label>
                </div>
              </div>
              <!-- Nested panel, it seems to work... -->
              <div class="panel panel-default responding-person">
                <div class="panel-body">
                  <div class="row form-group">
                    <div class="col-md-3">
                      <label for="id_respondent_name">{% trans "Namn" %}:</label>
                    </div>
                    <div class="col-md-9">
                      {{form.respondent_name}}
                    </div>
                  </div>
                  <div class="row form-group">
                    <div class="col-md-3">
                      <label for="id_respondent_email">{% trans "E-post" %}:</label>
                    </div>
                    <div class="col-md-9">
                      {{form.respondent_email}}
                    </div>
                  </div>
                  <div class="row form-group">
                    <div class="col-md-3">
                      <label for="id_respondent_phone">{% trans "Telefonnr" %}:</label>
                    </div>
                    <div class="col-md-9">
                      {{form.respondent_phone}}
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <input type="submit" class="btn btn-primary pull-right" value="{% trans 'Spara'%}"/>
              </div>

            </div><!-- panel-body -->
          </div><!-- panel -->

          {% for observation in form.instance.observations %}
            <div class="form-group">
              <label for="{{observation.variable.key}}">
                {{observation.variable.key}}
                {% if observation.variable.question %}
                  {{observation.variable.question}}
                {% else %}
                  {{observation.variable.description}}
                {% endif %}
                <span class="text-danger">DEBUG: {{observation.value}} ({{observation.variable.type}})</span>
              </label>
              {% if observation.variable.type == "string" %}
                <input type="text" name="{{observation.variable.key}}" id="observation_{{observation.instance_id}}" class="form-control" value="{{observation.value}}"/>
              {% elif observation.variable.type == "boolean" %}
                <div class="radio">
                  <label>
                    <input type="radio" name="{{observation.variable.key}}" id="observation_{{observation.instance_id}}" value="True" {% if observation.value == True %}checked="checked"{% endif %}/>
                    {% trans "Ja" %}
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="{{observation.variable.key}}" id="observation_{{observation.instance_id}}" value="False" {% if observation.value == False %}checked="checked"{% endif %}/>
                    {% trans "Nej" %}
                  </label>
                </div>
              {% elif observation.variable.type == "integer" or observation.variable.type == "long" %}
                 <input type="number" name="{{observation.variable.key}}" id="observation_{{observation.instance_id}}" class="form-control" value="{{observation.value}}"/>
              {% elif observation.variable.type == "decimal" %}
                <input type="text" name="{{observation.variable.key}}" id="observation_{{observation.instance_id}}" class="form-control" value="{{observation.value}}"/>
              {% elif observation.variable.type == "percent" %}
                <input type="number" name="{{observation.variable.key}}" id="observation_{{observation.instance_id}}" class="form-control" value="{% widthratio observation.value 1 100 %}"/>
              {% endif %}
            </div>
          {% endfor %}
        </form>
      </div>
      <div class="col-md-4"></div>
    </div>
  </div>
{% endblock %}
